<!doctype html>
<html>
<head>
	<title>Spil Jam! Maze Game</title>

	<link href="maze.css" rel="stylesheet" type="text/css" />
        <script src="config.js" type="text/javascript"></script>
        <script src="client/pubsub.js" type="text/javascript"></script>
        <script src="library/Command.js" type="text/javascript"></script>
	<script src="mazeGenerator.js" type="text/javascript"></script>
	<script src="game.js" type="text/javascript"></script>	
	<script src="client/websocket/swfobject.js" type="text/javascript"></script>
	<script src="client/websocket/web_socket.js" type="text/javascript"></script>
        <script src="library/Client.js" type="text/javascript"></script>
        <script src="client/client.js" type="text/javascript"></script>

</head>
<body style="margin:0; padding:0;">

	<div id="container">
	
	</div>
	
	<canvas id="maze" width="400" height="400" style="margin:auto; background-color:black;"></canvas> 

<div id=output></div>
	<input type="text" onkeyup="sendtest(this)"></input>
	<input value="join game" onclick="joinGame(this)" type="button"/>


</body>
</html>









 


<script>

document.onkeydown = myKeyDownHandler;

function myKeyDownHandler(e){
  console.log(e.keyCode);
}


sendtest = function(n){
	
	console.log("output",n.value);
	wsclient.send('test',{'messsage':n.value});
	
}


joinGame = function()
{
	wsclient.send('join',{});
	console.log('join game')
}

///other users joined
ev.sub('socket.onReceivePlayers',function(e){
	
	console.log('receive players',e);
	//insert player in game object
	//draw players
	window.game.setOpponents(e.players)
});

//you are joined
ev.sub('socket.onSelfJoined',function(e){
	
	//insert yourself into game object
	console.log('self joined',e)
	window.game.setPlayer(e.player)
	
});

//position update for other clients 
ev.sub('socket.onPositionUpdate',function(e){
	
	console.log('client position update',e);
	//draw players
});


ev.sub('game.onPlayerPositionUpdate',function(e){
	
	console.log('send server player pos update',e)
	wsclient.send('playerPositionUpdate',{'player':e});
	
});





	var cellWidth = 20;
	var cellHeight = 20;

player1 = {x:cellWidth/2,y:cellHeight/2,color:'ff0000'};
player2 = {x:333,y:200,color:'ff0000'};

playerGraphic = {w:cellWidth/2,h:cellHeight/2};

var players = [player1,player2];

window.game = new main(player1);  

///websocket testing
var wsclient = new Client(config.host, config.port);

wsclient.openSocket();
wsclient.getSocket().onopen = function(e){
  	
	
	console.log('websocket openened',e);
wsclient.send('mazeCreated',{'maze':game.getMaze()});

  //  wsclient.send('getGames',{'foo':'bar'});

};
        
wsclient.getSocket().onclose = function(e) {
	console.log('disconnected',e)
};
wsclient.getSocket().onerror = function(e) {
	console.log('onerror',e)
};







</script>